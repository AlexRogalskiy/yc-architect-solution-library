# Пиринг зоны MDB



### Зачем нужен 

Вы настроили роутинг между незавимыми сетями яндекс облака и хотите чтобы между этими зонами резолвились fqdn хостов созданных mdb кластеров. По умолчанию это сделать нельзя

Данный фунционал доступен в рамках сервиса Cloud DNS 

### Как сделать

По простому - надо создать зону  и добавить в нее все существующие сети. На примере терраформ

```
resource "yandex_dns_zone" "zone1" {
  name        = "mdb-zone"
  description = "desc"



  zone             = "mdb.yandexcloud.net."
  public           = false
  private_networks = ['ID_сети1','ID_сети2,..]
}
```



### Ограничения

1) Внутри спиренных сетей не будут доступны публичные записи хостов MDB из любых других сетей. Из внешнего интернета эти записи доступны будут
2) Вам надо быть администратором ( роль admin,editor или vpc.admin ) в каждом из фолдеров где находится спиренная сеть. Если вы пользуетесь несколькоми облаками то эту операцию можно выполнить только из учетной записи из Яндекс.Паспорта, которая имеет роль в нескольких облаках. Данную операцию не выполнить от имени сервисного аккаунта или федеративного аккаунта
3) IP связность между сетями вам надо сделать самостоятельно
4) Чтобы существующие записи смогли смигрировать в спиренный dns надо в каждой из сетей создать по ВМ (ее можно потом удалить)


### Как проверить

В решении доступен пример где можно это все проверить он доступен [тут](./example)
Запиренная зона должна содержать все A и CNAME записи например

![](./pics/zones.png)



### Расширение схемы


Иногда требуется резолвить хосты MDB через VPN или Интерконнект сразу из нескольких сетей. Чтобы это сделать 

1) Создайте в какой либо из спиренных сетей несколько ВМ и установите на них ПО для рекурсивного dns сервера (Например CoreDNS)
2) В каждом из dns серверов настройте форвардинг зоны . в адрес dns сервера данной сети ( это второй адрес из сабнета, в котором находится сеть. Также эта настройка приходит по dhcp) . Например можно использовать coredns с таким конфигом
```
. {
              errors
              forward . /etc/resolv.conf
              cache 30s
              health {
              }
          }
```
3) На стороне своего копоративного DNS пропишите записи типа
```
Зона mdb.yandexcloud.net обслуживается созданными DNS серверами ( форвардинг или NS записи)
```

