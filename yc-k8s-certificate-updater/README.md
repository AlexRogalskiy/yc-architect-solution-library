# Демонсет для обновления сертификатов на нодах Managed K8s

## Описание 
Демонсет  будет выполнять следующее: 

1. При помощи bash скрипта постояннo проверять наличие нужных CA сертификатов на нодах.
2. В случае, если их нет, копировать их из секрета и обновлять сертификаты.
3. Перезагружать kubelet и процесс среды выполнения контейнера.

Демонсет работает с нодами использующими Docker runtime. 

## Как запустить в общем случае

1) Создаем неймспейс для работы демонсета в целях изоляции его работы. 
```
kubectl apply -f certificate-updater-ns.yaml
```
2) Создаем простой секрет, с несколькими файлами внутри при помощи kubectl с указанием нескольких источников и созданного namespace. 
```
kubectl create secret generic crt   --from-file=num1.crt --from-file=num2.crt --from-file=num3.crt --from-file=num4.crt --from-file=num5.crt --namespace="certificate-updater"
```


Важно, что демонсет ссылается на сертификат с именем crt 

3) Создаем демонсет

```
kubectl apply -f certificate-updater-ds.yaml
```
Далее можно мониторить состояние демонсета, в случае когда произойдет обновление сертификатов, то поды  перезагрузят процесс docker и kubelet и перезагрузятся сами


### Обновление сертификатов

При помощи: 

```kubectl get secret crt -o yaml```

мы можем получить практически готовую для переиспользования конфигурацию. Для добавления данных в секрет как есть стоит предварительно кодировать файл при помощи команды base64 и дописать соотвествующее содержимое в yaml и применить заново
